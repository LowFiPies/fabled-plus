var ue=Object.defineProperty;var fe=(n,e,t)=>e in n?ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>(fe(n,typeof e!="symbol"?e+"":e,t),t);import{w as f,j as L,k as ge,e as T}from"./singletons.3b15088e.js";import{I as l}from"./index.e9b9921d.js";const ee={INT:/^-?[0-9]+$/,FLOAT:/^-?[0-9]+\.[0-9]+$/,SPACE:/^( +)/},q=n=>{n=n.replace(/\r\n/g,`
`).replace(/\n *\n/g,`
`).replace(/ +\n/g,`
`);const e=new m,t=0,s=n.split(`
`);return e.parse(s,t,0),e},R=n=>{const e=n.match(ee.SPACE);return e?e[1].length:0};class de{constructor(e){o(this,"data");o(this,"set",e=>this.data=e);o(this,"get",()=>this.data);this.data=e}}class m{constructor(e){o(this,"key");o(this,"data",{});o(this,"put",(e,t)=>{this.data[e]=t});o(this,"has",e=>this.data[e]!==void 0);o(this,"get",(e,t,s)=>((this.data[e]=="[]"||this.data[e]==" []")&&(this.data[e]=JSON.parse(this.data[e].trim())),this.has(e)?s?s(this.data[e]):this.data[e]:t));o(this,"getKeys",()=>Object.keys(this.data));o(this,"remove",e=>{delete this.data[e]});o(this,"parse",(e,t,s,i)=>{for(i&&(this.key=i);t<e.length&&R(e[t])>=s;){for(;t<e.length&&(R(e[t])!=s||e[t].replace(/ /g,"").charAt(0)=="#"||e[t].indexOf(":")==-1);)t++;if(t==e.length)return t;let r=e[t].substring(s,e[t].indexOf(":"));if(r==="loaded"){t++;continue}if(r.match(/^["'].*["']$/)&&(r=r.substring(1,r.length-1)),!this.key&&!i&&(this.key=r),e[t].search(/: +\{\}/)!=-1&&e[t].length>=4)this.data[r]=new m(r);else if(t<e.length-1&&e[t+1].charAt(s)=="-"&&e[t+1].charAt(s+1)==" "&&R(e[t+1])==s){const a=[];for(;++t<e.length&&e[t].charAt(s)=="-";){let c=e[t].substring(s+2);(c.charAt(0)=="'"||c.charAt(0)=='"')&&(c=c.substring(1,c.length-1).replace(/\\(['"])/,h=>h.replace("\\",""))),a.push(c)}this.data[r]=a,t--}else if(t<e.length-1&&R(e[t+1])>s){t++;const a=R(e[t]),c=new m;t=c.parse(e,t,a,r)-1,this.data[r]=c}else{let a=e[t].substring(e[t].indexOf(":")+2);a.charAt(0)=="'"||a.charAt(0)=='"'?a=a.substring(1,a.length-1):isNaN(a)||(ee.INT.test(a)?a=parseInt(a):a=parseFloat(a)),typeof a=="string"&&(a.toLowerCase()=="false"?a=!1:a.toLowerCase()=="true"?a=!0:a=a.replace(/\\(['"])/,c=>c.replace("\\",""))),this.data[r]=a}do t++;while(t<e.length&&e[t].replace(/ /g,"").charAt(0)=="#")}return Object.keys(this.data).length==1&&this.key&&this.data[this.key]instanceof m&&(this.data=this.data[this.key].data),t});o(this,"toString",()=>this.toYaml(this.key||this.data.name?"'"+(this.key||this.data.name)+"'":void 0,this.data));o(this,"toYaml",(e,t,s=new de("a"),i="")=>{if(t instanceof m)return t.toYaml("'"+(e??t.key)+"'",t.data,s,i);let r="";e&&(r+=i+e+`:
`,i+="  ");for(const a of Object.keys(t)){const c=t[a];let h="";if(c!=null){if(c instanceof Object)if(Object.keys(c).includes("toYaml"))if(c instanceof m){r+=c.toYaml("'"+a+"'",c.data,s,i);continue}else h=c.toYaml(i);else c instanceof Array&&(h=this.convertArray(a,s,i,c));else{const p=JSON.stringify(c);h=i+a+": "+p+`
`}h&&(r+=h.replaceAll(/(\\)?'/g,"\\'").replaceAll(/((\\)?")/g,p=>p.length==1?"'":p).replaceAll(/\\"/g,'"').replace(/\\\\/g,"\\"))}}return r});o(this,"nextChar",e=>/z+/.test(e)?e.replaceAll(/z/g,"a")+"a":e.substring(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1));this.key=e}convertArray(e,t,s,i){if(e!="attributes"){let r=s+e+":";if(["string","number"].includes(typeof i[0]))i.length>0?(r+=`
`,i.forEach(a=>r+=s+"- "+JSON.stringify(a)+`
`)):r+=` []
`;else if(e==="components"||e==="children")if(i.length==0)r+=` {}
`;else return r+=`
`,i.forEach(a=>{const c=t.get();t.set(this.nextChar(t.get())),r+=this.toYaml(a.name+"-"+c,a.toYamlObj(),t,s+"  ")}),r.replaceAll(/'/g,'"');else r+=` []
`;return r}else return this.toYaml(e,i,t,s)}}class u{constructor(e,t,s){o(this,"name");o(this,"base");o(this,"scale");o(this,"toYaml",(e="")=>e+this.name.toLowerCase()+"-base: "+this.base+`
`+e+this.name.toLowerCase()+"-scale: "+this.scale+`
`);this.name=e,this.base=t,this.scale=s}}class g{constructor(e){o(this,"key",{});o(this,"isFolder",!0);o(this,"open",!1);o(this,"name","Folder");o(this,"data",[]);o(this,"parent");o(this,"updateParent",e=>{this.parent=e});o(this,"add",e=>{this.data.includes(e)||(e instanceof g&&(J(e,this.data),Me(e),e.parent=this),this.data.push(e),this.sort())});o(this,"remove",e=>{this.data=this.data.filter(t=>t!=e),this.sort()});o(this,"sort",()=>{this.data=this.data.sort((e,t)=>{let s=0;return e instanceof g&&(t instanceof g||(s=-100)),e.name.localeCompare(t.name)+s}),U()});o(this,"createFolder",()=>{const e=new g;J(e,this.data),this.data.push(e),this.sort(),e.updateParent(this)});o(this,"deleteFolder",e=>{this.data=this.data.filter(t=>t!=e)});o(this,"contains",e=>{if(this.data.includes(e))return!0;for(const t of this.data.filter(s=>s instanceof g))if(t.contains(e))return!0;return!1});o(this,"getContainingFolder",e=>{if(this.data.includes(e))return this;for(const t of this.data.filter(s=>s instanceof g)){if(t.data.includes(e))return t;{const s=t.getContainingFolder(e);if(!s)continue;return s}}});e&&(this.data=e,e.forEach(t=>{t instanceof g&&t.isFolder&&t.updateParent(this)}))}}const we=n=>n.replace("_"," ").toLowerCase().replace(/^(.)|\s(.)/g,e=>e.toUpperCase()),te=n=>(n=n.replace("_"," "),n.substring(0,1).toUpperCase()+n.substring(1).toLowerCase()),k=n=>n.sort((e,t)=>e.name.localeCompare(t.name)),be=(n,e)=>{let t=e;localStorage.getItem(n)===null&&(typeof e=="string"||typeof e=="number"||typeof e=="boolean"?localStorage.setItem(n,e.toString()):localStorage.setItem(n,JSON.stringify(e))),typeof e=="number"?t=parseInt(localStorage.getItem(n)):typeof e=="boolean"?t=localStorage.getItem(n)==="true":typeof e=="string"?t=localStorage.getItem(n):t=JSON.parse(localStorage.getItem(n));const{subscribe:s,set:i,update:r}=f(t);return{subscribe:s,set:a=>(typeof a=="string"||typeof a=="number"||typeof a=="boolean"?localStorage.setItem(n,a.toString()):localStorage.setItem(n,JSON.stringify(a)),i(a)),update:r}};class se{}o(se,"new",()=>{throw new Error("'new' method not implemented")});class ke extends se{constructor(t,s){super();o(this,"type");o(this,"name");o(this,"description");o(this,"comment");o(this,"components",f([]));o(this,"data",[]);o(this,"preview",[]);o(this,"enablePreview",!1);o(this,"summaryItems",[]);o(this,"isParent",!0);o(this,"isDeprecated",!1);o(this,"id",{});o(this,"_defaultOpen",!1);o(this,"parent");o(this,"setComponents",t=>{t.forEach(s=>s.parent=this),this.components.set([...t])});o(this,"contains",t=>{const s=l(this.components);if(s.includes(t))return!0;for(const i of s)if(i.contains(t))return!0;return!1});o(this,"addComponent",(t,s=-1)=>{const i=l(this.components);s==-1?i.push(t):i.splice(s,0,t),this.setComponents(i)});o(this,"removeComponent",t=>{const s=l(this.components);if(s.includes(t)){s.splice(s.indexOf(t),1),t.parent=void 0,this.setComponents(s);return}for(const i of s)i.contains(t)&&i.removeComponent(t)});o(this,"defaultOpen",()=>(this._defaultOpen=!0,this));this.type=t,this.name=s.name,this.description=s.description??"",this.summaryItems=s.summaryItems??[],this.comment=s.comment??"",this.setComponents(s.components||[]),this.data=s.data||[],this.preview=s.preview||[]}getValue(t){var i;const s=(i=this.data)==null?void 0:i.find(r=>r.key==t);return!s||!s.meetsRequirements(this)?"":s.getSummary()}toYamlObj(){const t=new m(this.name);if(t.put("type",this.type),t.put("comment",this.comment),this.preview.length>0){const s=new m("preview");s.put("enabled",this.enablePreview),this.preview.filter(i=>i.meetsPreviewRequirements(this)).forEach(i=>{const r=i.getData();Object.keys(r).forEach(a=>s.put(a,r[a]))}),t.put("preview",s)}return t}getRawPreviewData(){const t=new m("preview");return this.preview.forEach(s=>{const i=s.getData();Object.keys(i).forEach(r=>t.put(r,i[r]))}),t}deserialize(t){const s=t.get("preview");s&&(this.enablePreview=s.get("enabled",!1),this.preview.forEach(i=>i.deserialize(s))),this.comment=t.get("comment","").replaceAll("\\n",`
`)}}const ne=f({}),ie=f({}),oe=f({}),re=f({}),Se=f(!1),$=f(""),Ce=L([ne,$],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),je=L(Ce,n=>{const e={};return n.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),Ke=L([ie,$],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),Ge=L([oe,$],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),ve=L([re,$],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),Ve=L(ve,n=>{const e={};return n.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),b=class b{};o(b,"getTriggerByName",e=>{var s;return(s=Object.values(l(ne)).find(i=>i.name.toLowerCase()===e.toLowerCase()))==null?void 0:s.component}),o(b,"getTargetByName",e=>{var s;return(s=Object.values(l(ie)).find(i=>i.name.toLowerCase()===e.toLowerCase()))==null?void 0:s.component}),o(b,"getConditionByName",e=>{var s;return(s=Object.values(l(oe)).find(i=>i.name.toLowerCase()===e.toLowerCase()))==null?void 0:s.component}),o(b,"getMechanicByName",e=>{var s;return(s=Object.values(l(re)).find(i=>i.name.toLowerCase()===e.toLowerCase()))==null?void 0:s.component}),o(b,"deserializeComponents",e=>{if(!e||!(e instanceof m))return[];const t=[],s=e.getKeys();for(const i of s){let r;const a=e.get(i),c=a.get("type");if(c==="trigger"){const h=b.getTriggerByName(i.split("-")[0]);h&&(r=h.new())}else if(c==="target"){const h=b.getTargetByName(i.split("-")[0]);h&&(r=h.new())}else if(c==="condition"){const h=b.getConditionByName(i.split("-")[0]);h&&(r=h.new())}else if(c==="mechanic"){const h=b.getMechanicByName(i.split("-")[0]);h&&(r=h.new())}r&&(r.deserialize(a),t.push(r))}return t});let N=b;const I=class I extends ke{constructor(t,s=!1){super("trigger",t);o(this,"mana",!1);o(this,"cooldown",!1);o(this,"clone",()=>new I({name:this.name,components:[...l(this.components)],mana:this.mana,cooldown:this.cooldown,data:[...this.data],preview:[...this.preview],comment:this.comment,description:this.description,summaryItems:[...this.summaryItems]}));this.mana=t.mana||!1,this.cooldown=t.cooldown||!1,super.isDeprecated=s}toYamlObj(){const t=super.toYamlObj(),s=this.getData();s.getKeys().length>0&&t.put("data",s);const i=l(this.components);return i.length>0&&t.put("children",i),t}getData(){const t=new m("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(t.put("mana",this.mana),t.put("cooldown",this.cooldown)),this.data.filter(s=>s.meetsRequirements(this)).forEach(s=>{const i=s.getData();Object.keys(i).forEach(r=>t.put(r,i[r]))}),t}getRawData(){const t=new m("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(t.put("mana",this.mana),t.put("cooldown",this.cooldown)),this.data.forEach(s=>{const i=s.getData();Object.keys(i).forEach(r=>t.put(r,i[r]))}),t}deserialize(t){super.deserialize(t);const s=t.get("data");s&&(this.mana=s.get("mana",!1),this.cooldown=s.get("cooldown",!1),this.data.forEach(i=>i.deserialize(s))),this.setComponents(t.get("children",[],i=>N.deserializeComponents(i)))}};o(I,"new",()=>new I({name:"null"}));let M=I;class S{constructor(e){o(this,"isSkill",!0);o(this,"key",{});o(this,"name");o(this,"type","Dynamic");o(this,"maxLevel",5);o(this,"skillReq");o(this,"skillReqLevel",0);o(this,"attributeRequirements",[]);o(this,"permission",!1);o(this,"levelReq",new u("level",1,0));o(this,"cost",new u("cost",1,0));o(this,"cooldown",new u("cooldown",0,0));o(this,"cooldownMessage",!0);o(this,"mana",new u("mana",0,0));o(this,"minSpent",new u("points-spent-req",0,0));o(this,"castMessage","&6{player} &2has cast &6{skill}");o(this,"combo","");o(this,"icon",{material:"Pumpkin",customModelData:0,lore:["&d{name} &7({level}/{max})","&2Type: &6{type}","","{req:level}Level: {attr:level}","{req:cost}Cost: {attr:cost}","","&2Mana: {attr:mana}","&2Cooldown: {attr:cooldown}"]});o(this,"incompatible",[]);o(this,"triggers",[]);o(this,"skillReqStr","");o(this,"incompStr",[]);o(this,"addComponent",e=>{var t;if(e instanceof M){this.triggers=[...this.triggers,e];return}this.triggers.length===0&&this.triggers.push((t=N.getTriggerByName("cast"))==null?void 0:t.new()),this.triggers[0].addComponent(e),this.triggers=[...this.triggers]});o(this,"removeComponent",e=>{if(e instanceof M&&this.triggers.includes(e)){this.triggers.splice(this.triggers.indexOf(e),1);return}for(const t of this.triggers)t.contains(e)&&t.removeComponent(e);this.triggers=[...this.triggers]});o(this,"serializeYaml",()=>{var i;const e=new m(this.name),t=new m;t.put("name",this.name),t.put("type",this.type),t.put("max-level",this.maxLevel),t.put("skill-req",(i=this.skillReq)==null?void 0:i.name),t.put("skill-req-lvl",this.skillReqLevel),t.put("needs-permission",this.permission),t.put("cooldown-message",this.cooldownMessage),t.put("msg",this.castMessage),t.put("combo",this.combo),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore);const s=new m("attributes");return s.put("level",this.levelReq),s.put("cost",this.cost),s.put("cooldown",this.cooldown),s.put("mana",this.mana),s.put("points-spent-req",this.minSpent),s.put("incompatible",this.incompatible.map(r=>r.name)),this.attributeRequirements.forEach(r=>s.put(r.name.toLowerCase(),r)),t.put("attributes",s),t.put("components",this.triggers),e.data=t.data,e});o(this,"load",e=>{this.name=e.get("name",this.name),this.type=e.get("type",this.type),this.maxLevel=e.get("max-level",this.maxLevel),this.skillReqStr=e.get("skill-req",this.skillReqStr),this.skillReqLevel=e.get("skill-req-lvl",this.skillReqLevel),this.permission=e.get("needs-permission",this.permission),this.cooldownMessage=e.get("cooldown-message",this.cooldownMessage),this.castMessage=e.get("msg",this.castMessage),this.combo=e.get("combo",this.combo);const t=e.get("attributes");this.levelReq=new u("level",t.get("level-base"),t.get("level-scale")),this.cost=new u("cost",t.get("cost-base"),t.get("cost-scale")),this.cooldown=new u("cooldown",t.get("cooldown-base"),t.get("cooldown-scale")),this.mana=new u("mana",t.get("mana-base"),t.get("mana-scale")),this.minSpent=new u("points-spent-req",t.get("points-spent-req-base"),t.get("points-spent-req-scale")),this.incompStr=t.get("incompatible",this.incompStr);const s=["level","cost","cooldown","mana","points-spent-req","incompatible"];console.log("attributes",t.getKeys());const i=new Set(t.getKeys().map(a=>a.replace(/-(base|scale)/i,"")).filter(a=>!s.includes(a)));console.log(i),this.attributeRequirements=[...i].map(a=>new u(a,t.get(a+"-base"),t.get(a+"-scale"))),this.icon.material=e.get("icon",this.icon.material,te),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore);let r;r=Se.subscribe(a=>{a&&(this.triggers=e.get("components",this.triggers,c=>N.deserializeComponents(c)),r&&r())})});o(this,"postLoad",()=>{this.skillReq=O(this.skillReqStr),this.incompatible=this.incompStr.map(e=>O(e)).filter(e=>!!e)});this.name=(e==null?void 0:e.name)||"Skill",e&&(e.type&&(this.type=e.type),e.maxLevel&&(this.maxLevel=e.maxLevel),e.skillReq&&(this.skillReq=e.skillReq),e.skillReqLevel&&(this.skillReqLevel=e.skillReqLevel),e.attributeRequirements&&(this.attributeRequirements=e.attributeRequirements.map(t=>new u(t.name,t.base,t.scale))),e.permission&&(this.permission=e.permission),e.levelReq&&(this.levelReq=e.levelReq),e.cost&&(this.cost=e.cost),e.cooldown&&(this.cooldown=e.cooldown),e.cooldownMessage&&(this.cooldownMessage=e.cooldownMessage),e.mana&&(this.mana=e.mana),e.minSpent&&(this.minSpent=e.minSpent),e.castMessage&&(this.castMessage=e.castMessage),e.combo&&(this.combo=e.combo),e.icon&&(this.icon=e.icon),e.incompatible&&(this.incompatible=e.incompatible),e.triggers&&(this.triggers=e.triggers))}}const Y=ge("goto"),ye=n=>{const e=[],t=q(n);let s;if(t.key&&!t.data[t.key]){const i=t.key;return i==="loaded"||(s=new S({name:i}),s.load(t),e.push(s)),e}for(const i in t.data)i!="loaded"&&t.data[i]instanceof m&&(s=new S({name:i}),s.load(t.data[i]),e.push(s));return e},ae=(n,e,t,s,i)=>{let r=e;{const p=localStorage.getItem(n);p&&(r=t(p),i&&i(r))}const{subscribe:a,set:c,update:h}=f(r);return{subscribe:a,set:p=>(s&&(p=s(p)),c(p)),update:h}},d=ae("skillData",[],n=>k(ye(n)),n=>(le(n),k(n))),O=n=>{for(const e of l(d))if(e.name==n)return e},C=ae("skillFolders",[],n=>!n||n==="null"?[]:JSON.parse(n,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return O(s);const i=new g(s.data);return i.name=s.name,i}return s}}),n=>{const e=JSON.stringify(n,(t,s)=>s instanceof S||s instanceof S?s.name:t==="parent"?void 0:s);return localStorage.setItem("skillFolders",e),k(n)}),A=n=>!!O(n),X=n=>{const e=l(d),t=new S({name:n||"Skill "+(e.length+1)});return e.push(t),d.set(e),t},He=n=>{const e=l(d);let t=n.name+" (Copy)",s=1;for(;A(t);)t=n.name+" (Copy "+s+")",s++;const i=new S;return i.load(q(n.serializeYaml().toString()).get(n.name)),i.name=t,e.push(i),d.set(e),i},Qe=n=>{const e=l(C);e.includes(n)||(J(n,e),e.push(n),e.sort((t,s)=>t.name.localeCompare(s.name)),C.set(e))},Oe=n=>{const e=l(C).filter(t=>t!=n);C.set(e)},Le=n=>{const e=l(d).filter(s=>s!=n),t=l(D);d.set(e),t instanceof S&&(e.length===0?Y(`${T}/`):e.find(s=>s===l(D))||Y(`${T}/skill/${e[0].name}`))},x=()=>d.set(k(l(d))),qe=()=>{C.set(k(l(C))),x()},H=n=>{const e=q(n);let t;if(e.key&&!e.data[e.key]){const s=e.key;t=A(s)?O(s):X(s),t.load(e),x();return}for(const s in e.data)s!="loaded"&&e.data[s]instanceof m&&!A(s)&&(t=A(s)?O(s):X(s),t.load(e.data[s]));x()},De=n=>{var t;const e=(t=n.target)==null?void 0:t.result;e&&H(e)},K=f(!1);let G;const le=n=>{l(K)&&G&&clearTimeout(G),K.set(!0),G=setTimeout(()=>{const e=n||l(d),t=new m;t.put("loaded",!1),e.forEach(s=>t.put(s.name,s.serializeYaml())),localStorage.setItem("skillData",t.toString()),K.set(!1)},2e3)};l(d).forEach(n=>n.postLoad());class v{constructor(e){o(this,"isClass",!0);o(this,"key",{});o(this,"name");o(this,"prefix","");o(this,"group","class");o(this,"manaName","&2Mana");o(this,"maxLevel",40);o(this,"parentStr","");o(this,"parent");o(this,"permission",!1);o(this,"expSources",273);o(this,"manaRegen",1);o(this,"health",new u("health",20,1));o(this,"mana",new u("mana",20,1));o(this,"attributes",[]);o(this,"skillTree","Requirement");o(this,"skills",[]);o(this,"icon",{material:"Pumpkin",customModelData:0});o(this,"unusableItems",[]);o(this,"actionBar","");o(this,"updateAttributes",e=>{const t=[];this.attributes=this.attributes.filter(s=>e!=null&&e.includes(s.name)?(t.push(s.name),!0):!1),e=e.filter(s=>!t.includes(s));for(const s of e)this.attributes.push(new u(s,0,0))});o(this,"serializeYaml",()=>{var s;const e=new m(this.name),t=new m;return t.put("name",this.name),t.put("action-bar",this.actionBar),t.put("prefix",this.prefix),t.put("group",this.group),t.put("mana",this.manaName),t.put("max-level",this.maxLevel),t.put("parent",((s=this.parent)==null?void 0:s.name)||""),t.put("needs-permission",this.permission),t.put("attributes",[this.health,this.mana,...this.attributes]),t.put("mana-regen",this.manaRegen),t.put("skill-tree",this.skillTree.toUpperCase().replace(/ /g,"_")),t.put("blacklist",this.unusableItems),t.put("skills",this.skills.map(i=>i.name)),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore),t.put("exp-source",this.expSources),e.data=t.data,e});o(this,"updateParent",e=>{this.parentStr&&(this.parent=e.find(t=>t.name===this.parentStr))});o(this,"load",e=>{this.name=e.get("name",this.name),this.actionBar=e.get("action-bar",this.actionBar),this.manaName=e.get("mana",this.manaName),this.prefix=e.get("prefix",this.prefix),this.group=e.get("group",this.group),this.maxLevel=e.get("max-level",this.maxLevel),this.parentStr=e.get("parent",this.parentStr),this.permission=e.get("needs-permission",this.permission),this.attributes=e.get("attributes",this.attributes,t=>{const s=[],i=t.get("health-base",20),r=t.get("health-scale",1),a=t.get("mana-base",20),c=t.get("mana-scale",1);this.health=new u("health",i,r),this.mana=new u("mana",a,c),t.remove("health-base"),t.remove("health-scale"),t.remove("mana-base"),t.remove("mana-scale");const h={};return Object.keys(t.data).forEach(p=>{const j=p.split("-"),F=j[0];h[F]||(h[F]=new u(F,0,0));const W=h[F];j[1]=="base"&&(W.base=Number.parseFloat(t.data[p])),j[1]=="scale"&&(W.scale=Number.parseFloat(t.data[p]))}),s.push(...Object.values(h)),s}),this.manaRegen=e.get("mana-regen",this.manaRegen),this.skillTree=e.get("skill-tree",this.skillTree,we),this.unusableItems=e.get("blacklist",this.unusableItems),this.skills=e.get("skills",this.skills,t=>t.map(s=>O(s)).filter(s=>!!s)),this.icon.material=e.get("icon",this.icon.material,te),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore),this.expSources=e.get("exp-source",this.expSources)});this.name=e?e.name:"Class",this.prefix=e!=null&&e.prefix?e.prefix:"&6"+this.name,e!=null&&e.group&&(this.group=e.group),e!=null&&e.manaName&&(this.manaName=e.manaName),e!=null&&e.maxLevel&&(this.maxLevel=e.maxLevel),e!=null&&e.parent&&(this.parent=e.parent),e!=null&&e.permission&&(this.permission=e.permission),e!=null&&e.expSources&&(this.expSources=e.expSources),e!=null&&e.health&&(this.health=e.health),e!=null&&e.mana&&(this.mana=e.mana),e!=null&&e.manaRegen&&(this.manaRegen=e.manaRegen),e!=null&&e.attributes&&(this.attributes=e.attributes),e!=null&&e.skillTree&&(this.skillTree=e.skillTree),e!=null&&e.skills&&(this.skills=e.skills),e!=null&&e.icon&&(this.icon=e.icon),e!=null&&e.unusableItems&&(this.unusableItems=e.unusableItems),e!=null&&e.actionBar&&(this.actionBar=e.actionBar)}}const Re=n=>{const e=[],t=q(n);let s;if(t.key&&!t.data[t.key]){const i=t.key;return i==="loaded"||(s=new v({name:i}),s.load(t),e.push(s)),e}for(const i in t.data)i!="loaded"&&t.data[i]instanceof m&&(s=new v({name:i}),s.load(t.data[i]),e.push(s));return e},ce=(n,e,t,s,i)=>{let r=e;{const p=localStorage.getItem(n);p&&(r=t(p),i&&i(r))}const{subscribe:a,set:c,update:h}=f(r);return{subscribe:a,set:p=>(s&&(p=s(p)),c(p)),update:h}},w=ce("classData",[],n=>k(Re(n)),n=>(he(n),n.forEach(e=>e.updateParent(n)),k(n)),n=>n.forEach(e=>e.updateParent(n))),B=n=>{for(const e of l(w))if(e.name==n)return e},y=ce("classFolders",[],n=>!n||n==="null"?[]:JSON.parse(n,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return B(s);const i=new g(s.data);return i.name=s.name,i}return s}}),n=>{const e=JSON.stringify(n,(t,s)=>s instanceof v||s instanceof S?s.name:t==="parent"?void 0:s);return localStorage.setItem("classFolders",e),k(n)}),Z=n=>l(w).forEach(e=>e.updateAttributes(n)),E=n=>!!B(n),_=n=>{const e=l(w),t=new v({name:n||"Class "+(e.length+1)});return e.push(t),w.set(e),t},We=n=>{const e=l(w);let t=n.name+" (Copy)",s=1;for(;E(t);)t=n.name+" (Copy "+s+")",s++;const i=new v;return i.load(q(n.serializeYaml().toString()).get(n.name)),i.name=t,e.push(i),w.set(e),i},Xe=n=>{const e=l(y);e.includes(n)||(J(n,e),e.push(n),e.sort((t,s)=>t.name.localeCompare(s.name)),y.set(e))},Ie=n=>{const e=l(y).filter(t=>t!=n);y.set(e)},Ne=n=>{const e=l(w).filter(s=>s!=n),t=l(D);w.set(e),t instanceof v&&(e.length===0?Y(`${T}/`):e.find(s=>s===l(D))||Y(`${T}/class/${e[0].name}/edit`))},P=()=>w.set(k(l(w))),ze=()=>{y.set(k(l(y))),P()},Q=n=>{const e=q(n);let t;if(e.key&&!e.data[e.key]){const s=e.key;t=E(s)?B(s):_(s),t.load(e),P();return}for(const s in e.data)s!="loaded"&&e.data[s]instanceof m&&!E(s)&&(t=E(s)?B(s):_(s),t.load(e.data[s]));P()},Fe=n=>{var t;const e=(t=n.target)==null?void 0:t.result;e&&Q(e)},he=n=>{const e=n||l(w),t=new m;t.put("loaded",!1),e.forEach(s=>t.put(s.name,s.serializeYaml())),localStorage.setItem("classData",t.toString())},Ae=(()=>{let n=["vitality","spirit","intelligence","dexterity","strength"];{const i=localStorage.getItem("attribs");i&&(n=i.split(","),Z(n))}const{subscribe:e,set:t,update:s}=f(n);return{subscribe:e,set:i=>(localStorage.setItem("attribs",i.join(",")),Z(i),t(i)),update:s}})(),me=n=>{const e=q(n),t=Object.keys(e.data);Ae.set(t)},D=f(void 0),Ee=L(D,n=>n instanceof v?"class":"skill"),Ze=f(),_e=f(),z=be("sidebarOpen",!0),et=f(!0),pe=f(!0),Te=f(!1),tt=()=>{l(z)&&(l(Ee)=="class"?P():x(),U())},st=()=>z.set(!l(z)),nt=()=>z.set(!1),it=n=>Te.set(n),J=(n,e)=>{const t=n.name;let s=1;for(;e.filter(i=>i instanceof g&&i.name==n.name).length>=1;)n.name=t+" ("+s+++")"},ot=n=>{n.parent?(n.parent.deleteFolder(n),U()):l(pe)?Ie(n):Oe(n)},rt=n=>{var e;n&&((e=Ye(n))==null||e.remove(n),n instanceof v?Ne(n):n instanceof S&&Le(n),U())},U=()=>{l(z)&&(l(pe)?ze():qe())},at=()=>{he(),le()},Me=n=>{const e=l(y),t=l(C);e.includes(n)&&y.set(e.filter(s=>s!=n)),t.includes(n)&&C.set(t.filter(s=>s!=n))},Ye=n=>{if(n instanceof g)return n.parent;const e=n instanceof v?l(y):l(C);for(const t of e){const s=t.getContainingFolder(n);if(s)return s}},xe=n=>{var t;const e=(t=n.target)==null?void 0:t.result;e&&(e.indexOf("global:")>=0?me(e):e.indexOf("components:")>=0||e.indexOf("group:")==-1&&e.indexOf("combo:")==-1&&e.indexOf("skills:")==-1?H(e):Q(e),document.activeElement.blur())},lt=n=>{n&&(n.indexOf("global:")>=0?me(n):n.indexOf("components:")>=0||n.indexOf("group:")==-1&&n.indexOf("combo:")==-1&&n.indexOf("skills:")==-1?(console.log("loading skills"),H(n.replace(`loaded: false
`,""))):(console.log("loading classes"),Q(n.replace(`loaded: false
`,""))))},ct=n=>{const e=new FileReader;n.name.indexOf("skills")==0?e.onload=De:n.name.indexOf("classes")==0?e.onload=Fe:e.onload=xe,e.readAsText(n)},ht=n=>{const e=n||l(D);e&&V(e.name+".yml",e.serializeYaml().toString())},Be=()=>{const n=l(d);n.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new m;e.put("loaded",!1);for(const t of n)e.put(t.name,t.serializeYaml());return e},Pe=()=>{const n=l(w);n.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new m;e.put("loaded",!1);for(const t of n)e.put(t.name,t.serializeYaml());return e},mt=()=>{const n=Be(),e=Pe();V("skills.yml",n.toString()),V("classes.yml",e.toString())},V=(n,e)=>{const t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=n,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)};export{ke as $,Qe as A,We as B,He as C,ht as D,rt as E,ot as F,Me as G,y as H,C as I,_ as J,X as K,nt as L,K as M,mt as N,z as O,u as P,Te as Q,$ as R,Ke as S,Ge as T,ve as U,Ve as V,_e as W,q as X,m as Y,N as Z,je as _,ct as a,Ae as a0,tt as a1,at as a2,we as a3,be as a4,Ee as b,D as c,w as d,v as e,B as f,Y as g,d as h,S as i,O as j,ne as k,lt as l,ie as m,oe as n,re as o,Se as p,M as q,Ye as r,it as s,st as t,et as u,Ze as v,U as w,g as x,pe as y,Xe as z};
